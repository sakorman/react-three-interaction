# 俯视图交互功能

俯视图现在支持完整的交互功能，包括对象拖拽、视图缩放和视角切换。

## 功能特性

### 🖱️ 鼠标交互

#### 左键操作
- **点击对象**：选择单个对象
- **Ctrl/Cmd + 点击**：多选对象（添加到现有选择）
- **拖拽对象**：移动选中的对象
- **点击空白处**：清除所有选择

#### 右键操作
- **拖拽视图**：平移俯视图视角

#### 滚轮操作
- **向上滚动**：放大视图
- **向下滚动**：缩小视图

### 📐 视角切换

支持三种视角模式：

1. **俯视图** - 从上方观看场景（默认）
2. **前视图** - 从前方观看场景
3. **侧视图** - 从侧面观看场景

每种视角都有对应的拖拽平面：
- 俯视图：XZ平面（水平面）
- 前视图：XY平面（垂直面）
- 侧视图：YZ平面（侧垂面）

### 🔧 工具栏功能

- **视角按钮**：快速切换俯视、前视、侧视
- **重置按钮**：恢复默认视角和缩放级别

### 📊 状态显示

#### 缩放指示器
在左上角显示当前缩放级别（如：缩放: 1.5x）

#### 交互状态
在视图中心显示当前操作状态（如：拖拽中...）

#### 操作提示
鼠标悬停时显示操作说明：
- 左键：选择/拖拽对象
- 右键：拖拽视图
- 滚轮：缩放视图
- Ctrl+左键：多选

## 使用方式

### 基本使用

```tsx
import { TopView } from '@/views/top-view';

// 在你的组件中使用
<TopView visible={showTopView} />
```

### 自定义配置

俯视图工具支持以下配置选项：

```typescript
interface TopViewToolOptions {
  enableDrag?: boolean;     // 启用拖拽功能
  enableZoom?: boolean;     // 启用缩放功能
  enableSelect?: boolean;   // 启用选择功能
  zoomSpeed?: number;       // 缩放速度（默认：0.1）
  minZoom?: number;         // 最小缩放级别（默认：0.1）
  maxZoom?: number;         // 最大缩放级别（默认：5）
}
```

### 事件监听

俯视图交互会触发以下事件：

```typescript
// 对象拖拽开始
editor.eventSystemInstance.on('object:drag:start', (data) => {
  console.log('开始拖拽对象:', data.objectId);
});

// 对象拖拽更新
editor.eventSystemInstance.on('object:drag:update', (data) => {
  console.log('拖拽位置更新:', data.position);
});

// 对象拖拽结束
editor.eventSystemInstance.on('object:drag:end', (data) => {
  console.log('拖拽结束:', data.endPosition);
});
```

## 技术实现

### 核心组件

1. **TopViewTool** - 处理所有交互逻辑
2. **TopView** - React 组件，渲染俯视图界面
3. **EventSystem** - 事件系统，处理交互事件传递

### 关键特性

- **多视角支持**：自动调整拖拽平面适应不同视角
- **精确拖拽**：使用射线投射和3D平面交点计算
- **流畅缩放**：正交相机缩放，保持精确的比例
- **状态同步**：与主编辑器状态完全同步
- **性能优化**：高效的事件处理和渲染更新

### 架构优势

- **模块化设计**：工具类独立，易于扩展和维护
- **类型安全**：完整的 TypeScript 类型定义
- **事件驱动**：松耦合的事件系统
- **响应式UI**：基于 MobX 的状态管理

## 最佳实践

### 用户体验

1. **直观操作**：遵循常见的3D建模软件交互习惯
2. **视觉反馈**：清晰的状态指示器和操作提示
3. **防误操作**：右键禁用浏览器菜单

### 性能优化

1. **事件节流**：鼠标移动事件优化处理
2. **按需渲染**：只在必要时更新视图
3. **资源清理**：组件卸载时正确清理事件监听器

### 扩展性

新的交互功能可以通过以下方式添加：

1. 继承 `BaseTool` 类
2. 实现特定的事件处理逻辑
3. 在 `TopView` 组件中集成

## 故障排除

### 常见问题

1. **拖拽不响应**
   - 检查对象是否有 `userData.id` 属性
   - 确认 `userData.selectable` 不为 `false`

2. **缩放异常**
   - 检查缩放级别是否在允许范围内
   - 确认相机类型为正交相机

3. **事件冲突**
   - 确保没有其他工具同时激活
   - 检查事件监听器是否正确清理

### 调试建议

1. 使用浏览器开发者工具查看控制台输出
2. 检查 `editorStore` 的状态变化
3. 确认事件系统的事件触发情况 